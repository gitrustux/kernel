# RUSTUX Kernel Testing Instructions via QEMU

---

## Overview
These instructions guide the AI CLI (Claude CLI) to test **RUSTUX kernels** across multiple architectures using QEMU. Both **headless (CLI)** and **graphical** testing modes are included. All tests should ensure that the kernel boots, system calls respond correctly, and cross-architecture behavior is consistent.

---

## 1. Pre-requisites

- QEMU installed for all target architectures:
  - `qemu-system-x86_64` for amd64
  - `qemu-system-arm` or `qemu-system-aarch64` for arm64
  - `qemu-system-riscv64` for riscv64
- Kernel images compiled for each architecture:
  - `rustux-amd64.bin`
  - `rustux-arm64.bin`
  - `rustux-riscv64.bin`
- Minimal disk image or initramfs:
  - `rootfs-amd64.img`
  - `rootfs-arm64.img`
  - `rootfs-riscv64.img`

---

## 2. Common CLI Flags

- `-nographic` → disable graphical display (serial console only)
- `-serial mon:stdio` → redirect serial console to standard input/output
- `-append "console=ttyS0 root=/dev/sda"` → kernel boot arguments
- `-hda <disk_image>` → assign disk image
- `-m <memory>` → set RAM size
- `-cpu <cpu_type>` → specify CPU model
- `-smp <cores>` → number of CPU cores

---

## 3. Testing RUSTUX Kernel on amd64 (x86_64)

**Headless mode (CLI only):**
```bash
qemu-system-x86_64 \
  -kernel rustux-amd64.bin \
  -hda rootfs-amd64.img \
  -append "console=ttyS0 root=/dev/sda" \
  -nographic \
  -serial mon:stdio \
  -m 2G \
  -smp 2
```

**Graphical mode:**
```bash
qemu-system-x86_64 \
  -kernel rustux-amd64.bin \
  -hda rootfs-amd64.img \
  -append "root=/dev/sda" \
  -m 2G \
  -smp 2
```

---

## 4. Testing RUSTUX Kernel on arm64 (AArch64)

**Headless mode:**
```bash
qemu-system-aarch64 \
  -machine virt \
  -cpu cortex-a57 \
  -m 2G \
  -smp 2 \
  -kernel rustux-arm64.bin \
  -append "console=ttyAMA0 root=/dev/vda" \
  -nographic \
  -serial mon:stdio \
  -drive file=rootfs-arm64.img,if=virtio,format=raw
```

**Graphical mode:**
```bash
qemu-system-aarch64 \
  -machine virt \
  -cpu cortex-a57 \
  -m 2G \
  -smp 2 \
  -kernel rustux-arm64.bin \
  -append "root=/dev/vda" \
  -drive file=rootfs-arm64.img,if=virtio,format=raw
```

---

## 5. Testing RUSTUX Kernel on riscv64

**Headless mode:**
```bash
qemu-system-riscv64 \
  -machine virt \
  -nographic \
  -kernel rustux-riscv64.bin \
  -append "console=ttyS0 root=/dev/vda" \
  -m 2G \
  -smp 2 \
  -drive file=rootfs-riscv64.img,if=virtio,format=raw
```

**Graphical mode:**
```bash
qemu-system-riscv64 \
  -machine virt \
  -kernel rustux-riscv64.bin \
  -append "root=/dev/vda" \
  -m 2G \
  -smp 2 \
  -drive file=rootfs-riscv64.img,if=virtio,format=raw
```

---

## 6. Automated Checks for AI CLI

1. Boot kernel successfully within 60 seconds
2. Detect proper architecture and device type
3. Verify serial output (console logs) for errors
4. Run minimal test programs via CLI:
   - File creation and read/write
   - Basic system calls (process creation, IPC)
   - Memory allocation tests
5. Log test results per architecture
6. Report failures with exact console output snippets

---

## 7. Optional Networking Tests

- Use QEMU user-mode networking for testing network syscalls:
```bash
-netdev user,id=net0 -device virtio-net-pci,netdev=net0
```
- Test ping, DNS lookup, and socket creation inside the kernel/userland

---

## Notes

- Adjust memory (`-m`) and CPU cores (`-smp`) per test requirements
- For mobile profile testing, ensure touch input is emulated if required
- Ensure all disk images are pre-populated with minimal OS or initramfs
- These instructions can be scripted for CI or AI CLI automation
